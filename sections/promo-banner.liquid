{% schema %}
{
  "name": "Promo Banner",
  "settings": [
    {
      "type": "text",
      "id": "banner_text",
      "label": "Banner Text",
      "default": "Limited time only! Sale up to 40% off"
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Background Image"
    },
    {
      "type": "text",
      "id": "sale_end",
      "label": "Sale End Time (YYYY-MM-DDTHH:MM:SS)",
      "default": "2026-02-25T23:59:59"
    }
  ],
  "presets": [
    {
      "name": "Promo Banner"
    }
  ]
}
{% endschema %}

<div class="promo-banner" {% if section.settings.background_image %}style="background-image: url('{{ section.settings.background_image | image_url: width: 2000 }}');"{% endif %}>
  <div class="promo-content">
    <h2>{{ section.settings.banner_text }}</h2>
    <div class="countdown" data-endtime="{{ section.settings.sale_end }}"></div>
  </div>
</div>

<style>
.promo-banner {
  width: 100%;
  height: 250px;
  background-size: cover;
  background-position: center;
  display: flex;
  justify-content: center;
  align-items: center;
  color: white;
  text-align: center;
  position: relative;
}

.promo-content {
  background: rgba(0,0,0,0.5);
  padding: 20px 40px;
  border-radius: 10px;
}

.promo-content h2 {
  font-size: 28px;
  margin-bottom: 10px;
}

.countdown {
  font-size: 20px;
  font-weight: bold;
}
</style>

<script>
function startCountdown(element) {
  const endTime = new Date(element.dataset.endtime).getTime();

  function updateTimer() {
    const now = new Date().getTime();
    const distance = endTime - now;

    if (distance < 0) {
      element.innerHTML = "Sale ended";
      clearInterval(interval);
      return;
    }

    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((distance % (1000 * 60)) / 1000);

    element.innerHTML = `${days}d ${hours}h ${minutes}m ${seconds}s`;
  }

  updateTimer();
  const interval = setInterval(updateTimer, 1000);
}

document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.countdown').forEach(el => startCountdown(el));
});
</script>